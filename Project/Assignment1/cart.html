<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link rel="stylesheet" href="style.css">
        <link rel="icon" href="img/hawaiian-shirt.png" type="image/png" />
        <title>H.Spot | Add To Cart</title>
        <style>
            .search {
                height: 3rem;
                display: flex;
                justify-content:center;
                align-items: center;
                }
    
            .search .box {
                height: 20px;
                display: flex;
                cursor: pointer;
                padding: 20px 3px;
                background: #fff;
                border-radius:30px;
                align-items: center;
                box-shadow: 0 10px 25px rgba(0,0,0, .3);
                }
            .dropbtn {
              background-color: #04AA6D;
              border-radius: 25px;
              color: white;
              padding: 16px;
              font-size: 16px;
              border: none;
              cursor: pointer;
            }
            
            .dropbtn:hover, .dropbtn:focus {
              background-color: #3e8e41;
            }
            
            #myInput {
              box-sizing: border-box;
              background-image: url('https://www.w3schools.com/howto/searchicon.png');
              background-position: 14px 12px;
              background-repeat: no-repeat;
              font-size: 16px;
              padding: 14px 20px 12px 45px;
              border: none;
              border-bottom: 1px solid #ddd;
            }
            
            #myInput:focus {outline: 3px solid #ddd;}
            
            .dropdown {
              position: relative;
              display: inline-block;
            }
            
            .dropdown-content {
              display: none;
              position: absolute;
              background-color: #f6f6f6;
              min-width: 230px;
              overflow: auto;
              border: 1px solid #ddd;
              z-index: 1;
            }
            
            .dropdown-content a {
              color: black;
              padding: 12px 16px;
              text-decoration: none;
              display: block;
            }
            
            .dropdown a:hover {background-color: #ddd;}
            
            .show {display: block;}
        </style>

    </head>
<body>
   
    <section id="header">
        <a href="index.html"><img src="img/logo.png" class="logo" alt=""></a>
        <div>
            <ul id="navbar">
                
               <!--search section starts-->
                <section class="search">
                    <div class="dropdown">
                        <button onclick="myFunction()" class="dropbtn"><li><i class="fas fa-search"></i></button>
                        <div id="myDropdown" class="dropdown-content">
                          <input type="text" placeholder="Searching..." id="myInput" onkeyup="filterFunction()">
                          <a href="sproductf1.html">Open Collar Short Sleeve Shirt</a>
                          <a href="sproductf6.html">Cotton Collar Long Sleeve Shirt</a>
                          <a href="sproductf7.html">Cotton Wide Pants</a>
                          <a href="sproductf8.html">Cotton Long Sleeve Blouse</a>
                          <a href="sproductn1.html">Cotton Stand Collar Long Sleeve</a>
                          <a href="sproductn5.html">Cotton Collar Long Sleeve Shirt</a>
                          <a href="sproductn6.html">Chino Shorts</a>
                          <a href="sproductn8.html">Cotton Stand Collar Short Shirt</a>
                        </div>
                      </div>
                      
                      <script>
                      /* When the user clicks on the button,
                      toggle between hiding and showing the dropdown content */
                      function myFunction() {
                        document.getElementById("myDropdown").classList.toggle("show");
                      }
                      
                      function filterFunction() {
                        var input, filter, ul, li, a, i;
                        input = document.getElementById("myInput");
                        filter = input.value.toUpperCase();
                        div = document.getElementById("myDropdown");
                        a = div.getElementsByTagName("a");
                        for (i = 0; i < a.length; i++) {
                          txtValue = a[i].textContent || a[i].innerText;
                          if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            a[i].style.display = "";
                          } else {
                            a[i].style.display = "none";
                          }
                        }
                      }
                    </script>
                </section>
                    <!--search section ends--></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a class="active" href="cart.html"><i class="fas fa-shopping-bag"></i></a></li>
                <li><a href="payment.html"><i class="fa fa-truck" style="font: size 16px"></i></a></li>
                <li><a href="Untitled-1.php"><i class="far fa-user-circle" style='font-size:24px'></i></a></li>
            </ul>

        </div>
        <div id="mobile">
            <a href="cart.html"><i class="fas fa-shopping-bag"></i></a>
            <i id="bar" class="fas fa-bars"></i>
        </div>
    </section>

    <section id="page-header">
        <h2>#fashion</h2>
        <p>Save more with coupons & up to 70% off! </p>
    </section>

    <section id="cart" class="section-p1">
      <table width="100%">
        <thead>
          <tr>
            <td>Remove</td>
            <td>Image</td>
            <td>Product</td>
            <td>Price</td>
            <td>Quantity</td>
            <td>Subtotal</td>
          </tr>
        </thead>
        <tbody>
            <td class="product-list"></td>
            <td id="quantity" style="display: none;"></td>
        </tbody>
      </table>
    </section>

    <section id="cart-add" class="section-p1">
        <div id="coupon">
            <h3>Apply Coupon</h3>
            <div>
                <input type="text" placeholder="Enter Your Coupon">
                <button class="normal">Apply</button>
            </div>
        </div>

        <div id="subtotal">
            <h3>Cart Total</h3>
            <table>
                <tr>
                    <td>Cart Subtotal</td>
                    <td id="subtotal-price"></td>
                </tr>
                <tr>
                    <td>Discount</td>
                    <td id="discount-price"></td>
                </tr>
                <tr>
                    <td>Shipping</td>
                    <td id="shipping-details"></td>
                </tr>
                <tr>
                    <td><strong>Total</strong></td>
                    <td id="total-price"><strong></strong></td>
                </tr>
            </table>
            <a href="payment.html"><button class="normal" onclick="alertBuy()">Proceed to checkout</button></a>
        </div>
    </section>

    <footer class="section-p1">
        <div class="col">
            <img class="logo" src="img/logo.png" alt="">
            <h4>Contact</h4>
            <p><strong>Address:</strong> Lot No. 241, Level 2, Suria KLCC, Kuala Lumpur City Centre.</p>
            <p><strong>Phone:</strong> +60323822828</p>
            <p><strong>Hours:</strong> 10:00am - 10pm, Mon - Sun</p>
            <div class="follow">
                <h4>Follow Us</h4>
                <div class="icon">
                    <i class="fab fa-facebook-square" style="font-size:24px; color:blue;"></i>
                    <i class="fab fa-instagram-square" style="font-size:24px; color:magenta"></i>
                    <i class="fab fa-twitter-square" style="font-size:24px; color:rgb(0, 183, 255)"></i>
                    <i class="fab fa-youtube-square" style="font-size:24px; color:red"></i>
                    <i class="fab fa-pinterest-square" style="font-size:24px;color: rgb(206, 1, 1);"></i>
                </div>
            </div>
        </div>

        <div class="col">
            <h4>About</h4>
            <a href="#">About Us</a>
            <a href="#">Delivery Information</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms & Conditions</a>
            <a href="#">Contact Us</a>
        </div>

        <div class="col">
            <h4>My Account</h4>
            <a href="#">Sign In</a>
            <a href="#">View Cart</a>
            <a href="#">My Wishlist</a>
            <a href="#">Track My Order</a>
            <a href="#">Help</a>
        </div>

        <div class="col install">
            <h4>Install App</h4>
            <p>From App Store or Google Play</p>
            <div class="row">
                <img src="img/pay/app.jpg" alt="">
                <img src="img/pay/play.jpg" alt="">
                <p>Secured Payment Gateways</p>
                <img src="img/pay/pay.png" alt="">
                
            </div>
        </div>
        <div class="copyright">
            <p>© 2023, H.Spot</p>
        </div>
    </footer>

    
</body>

    <script src="script.js"></script>
    <script>
        function removeItem(index){
            const cart = JSON.parse(localStorage.getItem("cart")) || [];

            cart.splice(index, 1);

            localStorage.setItem("cart", JSON.stringify(cart));

            displayCart();
        }

        function displayCart() {
            // Retrieve cart items from localStorage
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const productList = document.querySelector(".product-list");
        
            // Clear the existing cart display
            productList.innerHTML = "";

            let totalCartPrice = 0; // Initialize total cart price
            let totalQuantity = 0;
        
            // Loop through the cart items and display them
            cart.forEach((item, index) => {
                const productItem = document.createElement("tr");
                productItem.className = "product-item";

                // Calculate the total price for the item
                const itemTotalPrice = item.price * item.quantity;
                totalCartPrice += itemTotalPrice; // Update total cart price
                totalQuantity += item.quantity;
                
                productItem.innerHTML = `
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td><button class="btn" onclick="removeItem(${index})"><i class="fas fa-times-circle"></i></button></td>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td><img src="${item.image}" alt=""></td>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td>${item.title}</td>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td>RM${item.price.toFixed(2)}</td>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td><input type="number" id="quantity-${index}" value="${item.quantity}" min="1" onchange="updateQuantity(${index})"></td>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td id="total-price-${index}">RM${itemTotalPrice.toFixed(2)}</td>
                `;
                productList.appendChild(productItem);
            });

            // Update the item count and total price
            document.getElementById("quantity").textContent = totalQuantity;
            document.getElementById("subtotal-price").textContent = `RM${totalCartPrice.toFixed(2)}`;

            // Apply discount based on the number of products
            let discount = 0;
            if (totalQuantity >= 5 && totalQuantity <= 10) {
                discount = 0.05 * totalCartPrice; // 5% discount
            } else if (totalQuantity > 10) {
                discount = 0.15 * totalCartPrice; // 15% discount
            }
            document.getElementById("discount-price").textContent = `RM${discount.toFixed(2)}`;

            // Apply shipping fee
            let shippingFee = 10.00; // Default shipping fee
            if (totalCartPrice > 100 || totalCartPrice == 0) {
                shippingFee = 0; // Free shipping if total price is greater than RM100
            }
            // Update the shipping fee display
            const shippingFeeDisplay = shippingFee === 0 ? "Free" : `RM${shippingFee.toFixed(2)}`;
            document.getElementById("shipping-details").textContent = shippingFeeDisplay;
            const totalWithDiscountAndShipping = totalCartPrice - discount + shippingFee;
            document.getElementById("total-price").textContent = `RM${totalWithDiscountAndShipping.toFixed(2)}`;
        }        

        function updateQuantity(itemIndex) {
            const quantityInput = document.getElementById(`quantity-${itemIndex}`);
            const newQuantity = parseInt(quantityInput.value, 10);
        
            if (newQuantity < 1) {
                // If the user enters a quantity less than 1, set it to 1
                quantityInput.value = 1;
                newQuantity = 1; // Ensure the quantity is at least 1
            }
        
            // Update the quantity in the cart
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart[itemIndex].quantity = newQuantity;
            localStorage.setItem("cart", JSON.stringify(cart));
        
            // Set the updated quantity in the input element
            quantityInput.value = newQuantity;

             // Call displayCart to update the total price
             displayCart();
        }

        displayCart();

        function updateTotalPrice() {
            const totalCartPrice = parseFloat(document.getElementById("subtotal-price").textContent.replace("RM", ""));
            const shippingFee = 10.00; // Set the shipping fee as needed
            const totalPrice = totalCartPrice + shippingFee;
            document.getElementById("total-price").textContent = `RM${totalPrice.toFixed(2)}`;
        }
        
        // Call updateTotalPrice when the page loads and when you update the cart
        window.addEventListener('load', updateTotalPrice);

    </script>
    
</html>